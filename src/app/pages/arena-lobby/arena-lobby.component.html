<div class="arena-lobby-container">
  <div class="lobby-header">
    <button nz-button nzType="text" (click)="goBack()" class="back-btn">
      <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
      Quay láº¡i
    </button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <nz-spin nzSize="large" nzTip="ğŸ”„ Äang táº£i sÃ¢n chÆ¡i..."></nz-spin>
  </div>

  <div *ngIf="!loading && arenaInfo" class="arena-content">
    <!-- SÃ¢n ChÆ¡i Header -->
    <div class="arena-header">
      <div class="arena-title">
        <span nz-icon nzType="trophy" nzTheme="twotone" [nzTwotoneColor]="'#faad14'" class="arena-icon"></span>
        <h1>ğŸ® SÃ¢n ChÆ¡i Cá»™ng Äá»“ng</h1>
      </div>
      <p class="arena-description">{{ arenaInfo.deckName }}</p>
      <p class="arena-subdesc" *ngIf="arenaInfo.deckDescription">{{ arenaInfo.deckDescription }}</p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-section">
      <nz-card class="stat-card">
        <nz-statistic
          [nzValue]="arenaInfo.totalPlayers"
          nzTitle="NgÆ°á»i chÆ¡i"
          [nzPrefix]="playersIcon"
          [nzValueStyle]="{ color: '#3f8600' }">
          <ng-template #playersIcon>
            <span nz-icon nzType="team" nzTheme="outline"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>

      <nz-card class="stat-card">
        <nz-statistic
          [nzValue]="arenaInfo.totalSessions"
          nzTitle="LÆ°á»£t chÆ¡i"
          [nzPrefix]="sessionsIcon"
          [nzValueStyle]="{ color: '#1890ff' }">
          <ng-template #sessionsIcon>
            <span nz-icon nzType="fire" nzTheme="outline"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>

      <nz-card class="stat-card">
        <nz-statistic
          [nzValue]="arenaInfo.highestScore"
          nzTitle="Äiá»ƒm cao nháº¥t"
          [nzPrefix]="scoreIcon"
          [nzValueStyle]="{ color: '#cf1322' }">
          <ng-template #scoreIcon>
            <span nz-icon nzType="rocket" nzTheme="outline"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>

      <nz-card class="stat-card">
        <nz-statistic
          [nzValue]="Math.round(arenaInfo.averageScore)"
          nzTitle="Äiá»ƒm trung bÃ¬nh"
          [nzPrefix]="avgIcon"
          [nzValueStyle]="{ color: '#faad14' }">
          <ng-template #avgIcon>
            <span nz-icon nzType="line-chart" nzTheme="outline"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>
    </div>

    <!-- Top 3 Players -->
    <nz-card class="top-players-card" nzTitle="ğŸ† Top 3 Cao Thá»§">
      <div *ngIf="arenaInfo.topPlayers.length === 0" class="empty-state">
        <nz-empty nzNotFoundContent="ChÆ°a cÃ³ ngÆ°á»i chÆ¡i nÃ o. HÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn!"></nz-empty>
      </div>

      <div *ngIf="arenaInfo.topPlayers.length > 0" class="top-players-list">
        <div *ngFor="let player of arenaInfo.topPlayers" 
             class="player-item"
             [class.first-place]="player.rank === 1"
             [class.second-place]="player.rank === 2"
             [class.third-place]="player.rank === 3">
          <div class="player-rank">
            <nz-badge 
              [nzCount]="player.rank" 
              [nzStyle]="{ backgroundColor: getRankColor(player.rank) }">
              <span nz-icon [nzType]="getRankIcon(player.rank)" 
                    [style.color]="getRankColor(player.rank)" 
                    class="rank-icon"></span>
            </nz-badge>
          </div>
          
          <nz-avatar 
            [nzSrc]="player.avatar" 
            [nzSize]="48" 
            class="player-avatar">
          </nz-avatar>
          
          <div class="player-info">
            <div class="player-name">{{ player.displayName }}</div>
            <div class="player-stats">
              <span>{{ player.totalAttempts }} lÆ°á»£t chÆ¡i</span>
              <nz-divider nzType="vertical"></nz-divider>
              <span>TB: {{ player.averageScore }}</span>
            </div>
          </div>
          
          <div class="player-score">
            <div class="best-score">{{ player.bestScore }}</div>
            <div class="score-label">Äiá»ƒm cao nháº¥t</div>
          </div>
        </div>
      </div>
    </nz-card>

    <!-- User Stats -->
    <nz-card class="user-stats-card" nzTitle="ğŸ“Š ThÃ nh TÃ­ch Cá»§a Báº¡n">
      <div *ngIf="!arenaInfo.currentUserStats.hasPlayed" class="no-stats">
        <nz-empty nzNotFoundContent="Báº¡n chÆ°a chÆ¡i láº§n nÃ o. HÃ£y báº¯t Ä‘áº§u thá»­ thÃ¡ch!"></nz-empty>
      </div>

      <div *ngIf="arenaInfo.currentUserStats.hasPlayed" class="user-stats-grid">
        <div class="stat-item">
          <div class="stat-value">{{ arenaInfo.currentUserStats.rank }}</div>
          <div class="stat-label">Háº¡ng</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ arenaInfo.currentUserStats.bestScore }}</div>
          <div class="stat-label">Äiá»ƒm cao nháº¥t</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ arenaInfo.currentUserStats.totalAttempts }}</div>
          <div class="stat-label">LÆ°á»£t chÆ¡i</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ arenaInfo.currentUserStats.averageScore }}</div>
          <div class="stat-label">Äiá»ƒm trung bÃ¬nh</div>
        </div>
      </div>
    </nz-card>

    <!-- NÃºt HÃ nh Äá»™ng -->
    <div class="action-buttons">
      <button 
        nz-button 
        nzType="primary" 
        nzSize="large" 
        (click)="startGame()"
        [nzLoading]="startingGame"
        class="start-game-btn">
        <span nz-icon nzType="thunderbolt" nzTheme="outline"></span>
        ğŸ® Báº¯t Äáº§u Thi Äáº¥u
      </button>
      
      <button 
        nz-button 
        nzType="default" 
        nzSize="large" 
        (click)="viewLeaderboard()"
        class="leaderboard-btn">
        <span nz-icon nzType="trophy" nzTheme="outline"></span>
        ğŸ† Báº£ng Xáº¿p Háº¡ng
      </button>
    </div>

    <!-- HÆ°á»›ng Dáº«n ChÆ¡i -->
    <div class="game-info">
      <nz-card nzTitle="ğŸ“– HÆ°á»›ng Dáº«n ChÆ¡i">
        <ul>
          <li>ğŸ¯ Tráº£ lá»i <strong>Táº¤T Cáº¢</strong> tháº» trong bá»™</li>
          <li>â±ï¸ <strong>KHÃ”NG</strong> giá»›i háº¡n thá»i gian (thoáº£i mÃ¡i suy nghÄ©)</li>
          <li>ğŸ§ 50% cÃ¢u há»i nghe + 50% cÃ¢u Ä‘á»‹nh nghÄ©a</li>
          <li>â­ CÃ´ng thá»©c Ä‘iá»ƒm: <strong>Sá»‘ cÃ¢u Ä‘Ãºng Ã— 100 - Thá»i gian (giÃ¢y)</strong></li>
          <li>ğŸ† CÃ ng Ä‘Ãºng nhiá»u + CÃ ng nhanh = Xáº¿p háº¡ng cÃ ng cao</li>
          <li>ğŸ”„ ChÆ¡i <strong>khÃ´ng giá»›i háº¡n láº§n</strong> Ä‘á»ƒ cáº£i thiá»‡n ká»· lá»¥c</li>
        </ul>
      </nz-card>
    </div>
  </div>
</div>
