<div class="deck-library-container">
  
  <!-- Welcome Header -->
  <div class="welcome-header">
    <div class="welcome-content">
      <h1 class="welcome-title">
        <span nz-icon nzType="book" nzTheme="fill"></span>
        Th∆∞ vi·ªán th·∫ª c·ªßa b·∫°n
      </h1>
      <p class="welcome-subtitle">Qu·∫£n l√Ω v√† t·ªï ch·ª©c t·∫•t c·∫£ b·ªô th·∫ª h·ªçc t·∫≠p m·ªôt c√°ch th√¥ng minh</p>
    </div>
    <div class="header-actions">
      <button 
        nz-button 
        nzType="primary" 
        nzSize="large"
        class="create-deck-btn"
        (click)="openCreateDeckModal()">
        <span nz-icon nzType="plus" nzTheme="outline"></span>
        T·∫°o b·ªô th·∫ª m·ªõi
      </button>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="quick-stats">
    <nz-row [nzGutter]="[16, 16]">
      <nz-col [nzXs]="24" [nzSm]="8" [nzLg]="8">
        <div class="stat-card total-decks">
          <div class="stat-icon">
            <span nz-icon nzType="folder" nzTheme="fill"></span>
          </div>
          <div class="stat-info">
            <div class="stat-value">{{ totalDecks }}</div>
            <div class="stat-label">T·ªïng s·ªë b·ªô th·∫ª</div>
          </div>
        </div>
      </nz-col>
      
      <nz-col [nzXs]="24" [nzSm]="8" [nzLg]="8">
        <div class="stat-card total-cards">
          <div class="stat-icon">
            <span nz-icon nzType="credit-card" nzTheme="fill"></span>
          </div>
          <div class="stat-info">
            <div class="stat-value">{{ totalCards }}</div>
            <div class="stat-label">T·ªïng s·ªë th·∫ª</div>
          </div>
        </div>
      </nz-col>
      
      <nz-col [nzXs]="24" [nzSm]="8" [nzLg]="8">
        <div class="stat-card studying-decks">
          <div class="stat-icon">
            <span nz-icon nzType="fire" nzTheme="fill"></span>
          </div>
          <div class="stat-info">
            <div class="stat-value highlight">{{ studyingDecks }}</div>
            <div class="stat-label">ƒêang h·ªçc</div>
          </div>
        </div>
      </nz-col>
    </nz-row>
  </div>

  <!-- Search & Filter Section -->
  <nz-card class="filter-card" [nzBordered]="false">
    <div class="filter-content">
      <div class="filter-left">
        <div class="search-section">
          <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton" nzSize="large">
            <input 
              type="text" 
              nz-input 
              placeholder="T√¨m ki·∫øm trong th∆∞ vi·ªán..." 
              [(ngModel)]="searchText"
              (keyup.enter)="onSearch()"
              (input)="onSearch()"
              class="search-input">
          </nz-input-group>
          <ng-template #suffixIconButton>
            <button nz-button nzType="primary" nzSearch nzSize="large" (click)="onSearch()">
              <span nz-icon nzType="search"></span>
            </button>
          </ng-template>
        </div>
      </div>
      
      <div class="filter-right">
        <nz-select 
          [(ngModel)]="selectedCategory" 
          (ngModelChange)="onCategoryChange()"
          nzPlaceHolder="Tr·∫°ng th√°i"
          nzSize="large"
          class="category-select">
          <nz-option 
            *ngFor="let option of categoryOptions" 
            [nzLabel]="option.label" 
            [nzValue]="option.value">
          </nz-option>
        </nz-select>
        
        <nz-select 
          [(ngModel)]="selectedSort" 
          (ngModelChange)="onSortChange()"
          nzPlaceHolder="S·∫Øp x·∫øp"
          nzSize="large"
          class="sort-select">
          <nz-option 
            *ngFor="let option of sortOptions" 
            [nzLabel]="option.label" 
            [nzValue]="option.value">
          </nz-option>
        </nz-select>
      </div>
    </div>
    
    <!-- Results Info -->
    <div class="results-info">
      <span class="results-text">
        Hi·ªÉn th·ªã <strong>{{ filteredDecks.length }}</strong> trong t·ªïng s·ªë <strong>{{ totalDecks }}</strong> b·ªô th·∫ª
      </span>
    </div>
  </nz-card>

  <!-- Content Section -->
  <div class="content-section">
    
    <!-- Loading State with Shimmer -->
    <div *ngIf="isLoading" class="loading-skeleton">
      <nz-row [nzGutter]="[24, 24]">
        <nz-col *ngFor="let item of [1,2,3,4,5,6]" [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6" [nzXl]="6">
          <nz-card class="deck-card-premium skeleton-card" [nzLoading]="true">
            <div class="skeleton-content">
              <div class="skeleton-title"></div>
              <div class="skeleton-description"></div>
              <div class="skeleton-stats">
                <div class="skeleton-bar"></div>
                <div class="skeleton-bar short"></div>
              </div>
            </div>
          </nz-card>
        </nz-col>
      </nz-row>
    </div>

    <!-- Empty State - No Decks -->
    <nz-card 
      *ngIf="!isLoading && filteredDecks.length === 0 && searchText === '' && selectedCategory === 'all'" 
      class="empty-state-card">
      <div class="empty-content">
        <div class="empty-icon">
          <span nz-icon nzType="book" nzTheme="outline"></span>
        </div>
        <h3>B·∫Øt ƒë·∫ßu x√¢y d·ª±ng th∆∞ vi·ªán c·ªßa b·∫°n!</h3>
        <p>T·∫°o b·ªô th·∫ª ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh chinh ph·ª•c ng√¥n ng·ªØ</p>
        <div class="empty-actions">
          <button 
            nz-button 
            nzType="primary" 
            nzSize="large"
            (click)="openCreateDeckModal()"
            class="primary-action">
            <span nz-icon nzType="plus" nzTheme="outline"></span>
            T·∫°o b·ªô th·∫ª ƒë·∫ßu ti√™n
          </button>
        </div>
        
        <!-- Quick Tips -->
        <div class="quick-tips">
          <h4>üí° G·ª£i √Ω ƒë·ªÉ b·∫Øt ƒë·∫ßu</h4>
          <ul>
            <li>üéØ Ch·ªçn ch·ªß ƒë·ªÅ b·∫°n mu·ªën h·ªçc (Ti·∫øng Anh, L·ªãch s·ª≠, Khoa h·ªçc...)</li>
            <li>üìù B·∫Øt ƒë·∫ßu v·ªõi 5-10 th·∫ª c∆° b·∫£n</li>
            <li>üöÄ S·ª≠ d·ª•ng AI ƒë·ªÉ g·ª£i √Ω n·ªôi dung th√¥ng minh</li>
          </ul>
        </div>
      </div>
    </nz-card>

    <!-- No Results State -->
    <nz-card 
      *ngIf="!isLoading && filteredDecks.length === 0 && (searchText !== '' || selectedCategory !== 'all')" 
      class="no-results-card">
      <div class="no-results-content">
        <div class="no-results-icon">
          <span nz-icon nzType="search" nzTheme="outline"></span>
        </div>
        <h3>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h3>
        <p>Th·ª≠ thay ƒë·ªïi t·ª´ kh√≥a ho·∫∑c b·ªô l·ªçc ƒë·ªÉ t√¨m ƒë∆∞·ª£c b·ªô th·∫ª b·∫°n c·∫ßn</p>
        <button 
          nz-button 
          nzType="default"
          nzSize="large"
          (click)="searchText = ''; selectedCategory = 'all'; onSearch()">
          <span nz-icon nzType="reload" nzTheme="outline"></span>
          X√≥a b·ªô l·ªçc
        </button>
      </div>
    </nz-card>

    <!-- Deck Grid -->
    <div *ngIf="!isLoading && filteredDecks.length > 0" class="decks-section">
      <nz-row [nzGutter]="[24, 24]">
        <nz-col 
          *ngFor="let deck of filteredDecks; let i = index" 
          [nzXs]="24" 
          [nzSm]="12" 
          [nzMd]="8" 
          [nzLg]="6"
          [nzXl]="6"
          [style.animation-delay.ms]="i * 100">
          
          <nz-card 
            class="deck-card-premium"
            nzHoverable>
            
            <!-- Card Header -->
            <div class="deck-header">
              <div class="deck-title-section">
                <h3 class="deck-title" [nzTooltipTitle]="deck.name" nz-tooltip (click)="viewDeckDetail(deck)" style="cursor: pointer;">
                  {{ deck.name }}
                </h3>
                <nz-tag [nzColor]="getTagColor(deck)" class="deck-status">
                  {{ getTagText(deck) }}
                </nz-tag>
              </div>
            </div>

            <!-- Card Content -->
            <div class="deck-content">
              <p class="deck-description" [nzTooltipTitle]="deck.description" nz-tooltip>
                {{ deck.description || 'Ch∆∞a c√≥ m√¥ t·∫£' }}
              </p>
              
              <!-- Stats Row -->
              <div class="deck-stats-row">
                <div class="stat-item">
                  <span nz-icon nzType="credit-card" nzTheme="outline"></span>
                  <span class="stat-text">{{ deck.cardCount || 0 }} th·∫ª</span>
                </div>
                <div class="stat-item">
                  <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
                  <span class="stat-text">{{ Math.ceil((deck.cardCount || 0) * 2) }}p</span>
                </div>
              </div>

              <!-- Progress Section -->
              <div class="progress-section">
                <div class="progress-header">
                  <span class="progress-label">Ti·∫øn ƒë·ªô h·ªçc t·∫≠p</span>
                  <span class="progress-percent">{{ calculateProgress(deck) }}%</span>
                </div>
                <nz-progress 
                  [nzPercent]="calculateProgress(deck)" 
                  [nzStatus]="calculateProgress(deck) === 100 ? 'success' : 'active'"
                  [nzStrokeColor]="getProgressColor(calculateProgress(deck))"
                  [nzShowInfo]="false"
                  [nzStrokeWidth]="8"
                  nzSize="small">
                </nz-progress>
              </div>
            </div>

            <!-- Card Footer Actions -->
            <div class="card-footer-actions">
              <div class="footer-left">
                <button
                  nz-button
                  nzType="primary"
                  nzSize="large"
                  [disabled]="(deck.cardCount || 0) < 5"
                  (click)="startStudying(deck)">
                  <span nz-icon nzType="rocket" nzTheme="outline"></span>
                  B·∫Øt ƒë·∫ßu Chinh ph·ª•c
                </button>
              </div>
              <div class="footer-right">
                <button
                  nz-button
                  nzType="default"
                  nzSize="default"
                  nz-dropdown
                  [nzDropdownMenu]="menu">
                  <span nz-icon nzType="more" nzTheme="outline"></span>
                </button>
                <nz-dropdown-menu #menu="nzDropdownMenu">
                  <ul nz-menu>
                    <li nz-menu-item (click)="viewDeckDetail(deck)">
                      <span nz-icon nzType="edit" nzTheme="outline"></span>
                      Ch·ªânh s·ª≠a
                    </li>
                    <li nz-menu-item (click)="duplicateDeck(deck)">
                      <span nz-icon nzType="copy" nzTheme="outline"></span>
                      Sao ch√©p
                    </li>
                    <li nz-menu-item (click)="exportDeck(deck)">
                      <span nz-icon nzType="export" nzTheme="outline"></span>
                      Xu·∫•t file
                    </li>
                    <li nz-menu-divider></li>
                    <li nz-menu-item class="danger-item" nz-popconfirm nzPopconfirmTitle="B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b·ªô th·∫ª n√†y?" nzPopconfirmPlacement="left" (nzOnConfirm)="deleteDeck(deck)">
                      <span nz-icon nzType="delete" nzTheme="outline"></span>
                      X√≥a b·ªô th·∫ª
                    </li>
                  </ul>
                </nz-dropdown-menu>
              </div>
            </div>

          </nz-card>
        </nz-col>
      </nz-row>
    </div>

  </div>
</div>