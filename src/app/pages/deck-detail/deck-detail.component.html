<!-- üé® DECK DETAIL - PREMIUM UI/UX -->
<div class="deck-detail-container">
  <!-- Back Button -->
  <div class="deck-header">
    <button nz-button nzType="text" (click)="goBack()" class="back-btn">
      <i class="fa-solid fa-arrow-left"></i>
      Quay l·∫°i
    </button>
  </div>

  <!-- Deck Info Card -->
  <nz-card *ngIf="!isLoadingDeck && deck" class="deck-info-card" [nzBordered]="false" style="margin-bottom: 32px;">
    <div class="deck-info">
      <div class="deck-main-info">
        <h1 class="deck-name">{{ deck.name }}</h1>
        <p class="deck-description">{{ deck.description }}</p>
        <div class="deck-stats">
          <div class="stat-item">
            <app-card-icon [color]="'#ffffff'" [size]="'14px'"></app-card-icon>
            <span class="stat-value">{{ deck.cardCount || 0 }}</span>
            <span class="stat-label">th·∫ª</span>
          </div>
          <div class="stat-item">
            <i class="fa-solid fa-users"></i>
            <span class="stat-value">{{ memberCount }}</span>
            <span class="stat-label">th√†nh vi√™n</span>
          </div>
        </div>
      </div>
      <div class="deck-actions">
        <button nz-button nzType="primary" nzSize="large"
          (click)="startLearning()"
          [disabled]="!cards.length || cards.length < 5"
          class="start-learning-btn">
          <i class="fa-solid fa-rocket" style="margin-right: 6px;"></i>
          B·∫Øt ƒë·∫ßu Chinh ph·ª•c
        </button>
        <button nz-button nzType="default" nzSize="large"
          (click)="goToArena()"
          [disabled]="!cards.length"
          class="arena-btn">
          <i class="fa-solid fa-trophy" style="margin-right: 6px; color: #ffffff;"></i>
          S√¢n Ch∆°i C·ªông ƒê·ªìng
        </button>
      </div>
    </div>
  </nz-card>

  <nz-card *ngIf="isLoadingDeck" [nzBordered]="false">
    <div style="text-align: center; padding: 40px;">
      <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    </div>
  </nz-card>

  <!-- Tab Navigation -->
  <nz-tabset [(nzSelectedIndex)]="selectedTab" (nzSelectedIndexChange)="onTabChange($event)" 
    nzType="card" nzSize="large" class="deck-tabs">
    
    <!-- FLASHCARDS TAB -->
    <nz-tab [nzTitle]="cardsTabTitle">
      <ng-template #cardsTabTitle>
        <app-card-icon [color]="'#6d8351'" [size]="'16px'"></app-card-icon>
        Flashcards
        <nz-badge [nzCount]="cards.length" [nzOverflowCount]="999" nzShowZero></nz-badge>
      </ng-template>

      <div class="cards-section">
        <div class="section-header">
          <h2 style="font-weight: 800; color: #6d8351;"><app-card-icon [color]="'#6d8351'" [size]="'16px'"></app-card-icon> Danh s√°ch Flashcard</h2>
          <div class="section-header-actions">
            <button style="border-radius: 16px;" nz-button nzSize="large" (click)="openBulkCreateModal()">
              <i class="fa-solid fa-bolt" style="margin-right: 6px;"></i> T·∫°o nhanh v·ªõi AI
            </button>
            <button style="border-radius: 16px; background: #6d8351;" nz-button nzType="primary" nzSize="large" (click)="openAddCardModal()">
              <i class="fa-solid fa-plus" style="margin-right: 6px;"></i> Th√™m th·∫ª m·ªõi
            </button>
          </div>
        </div>

        <div *ngIf="isLoadingCards" class="loading-container">
          <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
          <p>ƒêang t·∫£i danh s√°ch th·∫ª...</p>
        </div>

        <nz-empty *ngIf="!isLoadingCards && !cards.length" nzNotFoundImage="simple" class="empty-state">
          <div nz-empty-footer class="empty-message">
            <h3>‚ú® B·ªô th·∫ª c√≤n tr·ªëng</h3>
            <p>H√£y th√™m √≠t nh·∫•t 5 th·∫ª ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
            <button nz-button nzType="primary" nzSize="large" (click)="openAddCardModal()" style="margin-top: 16px;">
              <i class="fa-solid fa-plus"></i> Th√™m th·∫ª ƒë·∫ßu ti√™n
            </button>
          </div>
        </nz-empty>

        <div *ngIf="!isLoadingCards && cards.length" class="cards-grid">
          <div *ngFor="let card of cards; let i = index" class="card-item">
            <div class="card-header">
              <span class="card-number">Th·∫ª #{{ i + 1 }}</span>
              <div class="card-actions">
                <button nz-button nzType="text" nzSize="small" (click)="openEditCardModal(card)" nz-tooltip="Ch·ªânh s·ª≠a">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button nz-button nzType="text" nzSize="small" nz-popconfirm nzPopconfirmTitle="X√≥a th·∫ª n√†y?"
                  (nzOnConfirm)="deleteCard(card)" nz-tooltip="X√≥a">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="card-content">
              <div class="card-side front-side">
                <div class="side-label"><i class="fa-solid fa-eye"></i> M·∫∑t tr∆∞·ªõc</div>
                <div class="side-content">{{ card.frontText }}</div>
              </div>
              <div class="card-divider"><i class="fa-solid fa-arrow-right"></i></div>
              <div class="card-side back-side">
                <div class="side-label"><i class="fa-solid fa-lightbulb"></i> M·∫∑t sau</div>
                <div class="side-content">{{ card.backText }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nz-tab>

    <!-- MEMBERS TAB -->
    <nz-tab [nzTitle]="membersTabTitle">
      <ng-template #membersTabTitle>
        <i class="fa-solid fa-users" style="color: #6d8351;"></i>
        Th√†nh vi√™n
        <nz-badge [nzCount]="memberCount" [nzOverflowCount]="999" nzShowZero></nz-badge>
      </ng-template>

      <div class="members-section">
        <div class="section-header">
          <div class="section-title">
            <h2><i class="fa-solid fa-users title-icon"></i> Th√†nh vi√™n b·ªô th·∫ª</h2>
            <p class="subtitle">M·ªùi b·∫°n b√® c√πng h·ªçc ƒë·ªÉ tƒÉng ƒë·ªông l·ª±c!</p>
          </div>
          <button 
            *ngIf="isCurrentUserOwner"
            nz-button 
            nzType="primary" 
            nzSize="large" 
            class="invite-btn" 
            (click)="openInviteModal()"
            nz-tooltip
            nzTooltipTitle="Ch·ªâ ch·ªß s·ªü h·ªØu b·ªô th·∫ª m·ªõi c√≥ th·ªÉ m·ªùi th√†nh vi√™n">
            <span nz-icon nzType="user-add"></span> M·ªùi th√†nh vi√™n
          </button>
        </div>

        <div *ngIf="isLoadingMembers" class="loading-container">
          <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
          <p>ƒêang t·∫£i danh s√°ch th√†nh vi√™n...</p>
        </div>

        <nz-empty *ngIf="!isLoadingMembers && !members.length" nzNotFoundImage="simple" class="empty-state">
          <div nz-empty-footer class="empty-message">
            <h3>üë• Ch∆∞a c√≥ th√†nh vi√™n n√†o</h3>
            <p *ngIf="isCurrentUserOwner">H√£y m·ªùi b·∫°n b√® c√πng h·ªçc!</p>
            <p *ngIf="!isCurrentUserOwner">B·ªô th·∫ª n√†y ch∆∞a c√≥ th√†nh vi√™n n√†o kh√°c.</p>
            <button 
              *ngIf="isCurrentUserOwner"
              nz-button 
              nzType="primary" 
              nzSize="large" 
              (click)="openInviteModal()" 
              style="margin-top: 16px;">
              <i class="fa-solid fa-user-plus"></i> M·ªùi th√†nh vi√™n ƒë·∫ßu ti√™n
            </button>
          </div>
        </nz-empty>

        <div *ngIf="!isLoadingMembers && members.length" class="members-grid">
          <div *ngFor="let member of members" class="member-card" [class.is-owner]="isOwner(member)">
            <div class="member-header">
              <nz-avatar [nzSize]="64" [nzText]="getUserInitials(member.userName)"
                [ngStyle]="{'background-color': getAvatarColor(member.userId)}"></nz-avatar>
              <nz-tag *ngIf="isOwner(member)" [nzColor]="'gold'" class="role-badge" style="border-radius: 16px;">
                <i class="fa-solid fa-crown"></i> Owner
              </nz-tag>
              <nz-tag *ngIf="!isOwner(member)" [nzColor]="'#6d8351'" class="role-badge" style="border-radius: 16px;">
                <i class="fa-solid fa-user"></i> Member
              </nz-tag>
            </div>
            <div class="member-info">
              <h3 class="member-name">{{ member.userName }}</h3>
              <p class="member-email"><i class="fa-solid fa-envelope"></i> {{ member.userEmail }}</p>
              <p class="member-joined"><i class="fa-solid fa-calendar"></i> {{ member.joinedAt | date: 'dd/MM/yyyy' }}</p>
            </div>
            <div class="member-actions">
              <!-- Ch·ªâ hi·ªán n√∫t x√≥a n·∫øu: user hi·ªán t·∫°i l√† owner v√† th√†nh vi√™n ƒë√≥ kh√¥ng ph·∫£i owner -->
              <button *ngIf="isCurrentUserOwner && !isOwner(member)" 
                nz-button nzDanger nz-popconfirm
                nzPopconfirmTitle="X√≥a th√†nh vi√™n n√†y kh·ªèi b·ªô th·∫ª?" 
                (nzOnConfirm)="removeMember(member)" 
                nz-tooltip="Ch·ªâ ch·ªß s·ªü h·ªØu m·ªõi c√≥ th·ªÉ x√≥a th√†nh vi√™n">
                <i class="fa-solid fa-user-minus"></i>
              </button>
              
              <!-- Hi·ªÉn th·ªã label "B·∫°n" n·∫øu ƒë√¢y l√† ch√≠nh user hi·ªán t·∫°i -->
              <nz-tag *ngIf="member.userId === currentUserId" [nzColor]="'green'" class="current-user-tag">
                <i class="fa-solid fa-user"></i> B·∫°n
              </nz-tag>
            </div>
          </div>
        </div>
      </div>
    </nz-tab>
  </nz-tabset>
</div>

<!-- INVITE MODAL -->
<nz-modal [(nzVisible)]="isInviteModalVisible" nzTitle="M·ªùi th√†nh vi√™n m·ªõi" nzCentered
  [nzOkLoading]="isInviting" (nzOnCancel)="handleInviteCancel()" (nzOnOk)="sendInvitation()"
  nzOkText="G·ª≠i l·ªùi m·ªùi" nzCancelText="H·ªßy" nzWidth="500px" nzClassName="invite-modal">
  <div *nzModalContent>
    <div class="invite-modal-content">
      <div class="modal-icon-wrapper">
        <div class="modal-icon"><i class="fa-solid fa-envelope"></i></div>
      </div>
      <p class="modal-description">Nh·∫≠p email ng∆∞·ªùi d√πng b·∫°n mu·ªën m·ªùi v√†o <strong>"{{ deck?.name }}"</strong></p>
      <form nz-form [formGroup]="inviteForm" class="invite-form">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzRequired>Email</nz-form-label>
          <nz-form-control [nzSpan]="24" nzErrorTip="Vui l√≤ng nh·∫≠p email h·ª£p l·ªá">
            <nz-input-group nzSize="large" [nzPrefix]="prefixTemplate">
              <input nz-input formControlName="email" placeholder="example@gmail.com" type="email" />
            </nz-input-group>
            <ng-template #prefixTemplate><i class="fa-solid fa-envelope"></i></ng-template>
          </nz-form-control>
        </nz-form-item>
      </form>
      <div class="invite-tips">
        <div class="tip-item"><i class="fa-solid fa-info-circle"></i> Email ph·∫£i ƒë√£ ƒëƒÉng k√Ω trong h·ªá th·ªëng</div>
      </div>
    </div>
  </div>
</nz-modal>
