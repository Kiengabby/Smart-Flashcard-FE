<div class="deck-detail-container">
  <!-- Header -->
  <div class="deck-header">
    <button nz-button nzType="text" (click)="goBack()" class="back-btn">
      <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
      Quay l·∫°i
    </button>
  </div>

  <!-- Deck Info Card -->
  <nz-card 
    *ngIf="!isLoadingDeck && deck" 
    class="deck-info-card"
    [nzBordered]="false">
    <div class="deck-info">
      <div class="deck-main-info">
        <h1 class="deck-name">{{ deck.name }}</h1>
        <p class="deck-description">{{ deck.description }}</p>
        <div class="deck-stats">
          <div class="stat-item">
            <span nz-icon nzType="credit-card" nzTheme="outline"></span>
            <span class="stat-value">{{ deck.cardCount || 0 }}</span>
            <span class="stat-label">th·∫ª</span>
          </div>
        </div>
      </div>
      <div class="deck-actions">
        <button 
          nz-button 
          nzType="primary" 
          nzSize="large"
          (click)="startLearning()"
          [disabled]="!cards.length">
          <span nz-icon nzType="rocket" nzTheme="outline"></span>
          B·∫Øt ƒë·∫ßu Chinh ph·ª•c
        </button>
      </div>
    </div>
  </nz-card>

  <!-- Loading state cho deck info -->
  <nz-card *ngIf="isLoadingDeck" [nzBordered]="false">
    <div style="text-align: center; padding: 40px;">
      <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    </div>
  </nz-card>

  <nz-divider></nz-divider>

  <!-- üé® MODERN TAB NAVIGATION -->
  <nz-tabset 
    [(nzSelectedIndex)]="selectedTab"
    (nzSelectedIndexChange)="onTabChange($event)"
    nzType="card"
    nzSize="large"
    class="deck-tabs">
    
    <!-- üìá CARDS TAB -->
    <nz-tab>
      <span nz-tab-link>
        <span nz-icon nzType="credit-card" nzTheme="outline"></span>
        Flashcards
        <nz-badge [nzCount]="cards.length" [nzOverflowCount]="999" nzShowZero></nz-badge>
      </span>

      <!-- Cards Section -->
      <div class="cards-section">
    <div class="section-header">
      <div class="section-title">
        <h2>
          <span nz-icon nzType="credit-card" nzTheme="outline" class="title-icon"></span>
          Danh s√°ch Flashcard
        </h2>
        <span class="card-count" *ngIf="cards.length">{{ cards.length }} th·∫ª</span>
      </div>
      <div class="section-header-actions">
        <button 
          nz-button 
          nzType="default" 
          nzSize="large"
          class="bulk-create-btn"
          (click)="openBulkCreateModal()">
          <span nz-icon nzType="thunderbolt" nzTheme="outline"></span>
          T·∫°o nhanh v·ªõi AI
        </button>
        <button 
          nz-button 
          nzType="primary" 
          nzSize="large"
          class="add-card-btn"
          (click)="openAddCardModal()">
          <span nz-icon nzType="plus" nzTheme="outline"></span>
          Th√™m th·∫ª m·ªõi
        </button>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="isLoadingCards" class="loading-container">
      <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
      <p>ƒêang t·∫£i danh s√°ch th·∫ª...</p>
    </div>

    <!-- Empty state -->
    <nz-empty 
      *ngIf="!isLoadingCards && !cards.length"
      nzNotFoundImage="simple"
      class="empty-state">
      <div nz-empty-footer class="empty-message">
        <h3>‚ú® B·ªô th·∫ª c√≤n tr·ªëng</h3>
        <p>H√£y th√™m √≠t nh·∫•t 5 th·∫ª ƒë·ªÉ b·∫Øt ƒë·∫ßu chinh ph·ª•c!</p>
        <p class="tip">üí° M·∫πo: Ch·ªâ c·∫ßn nh·∫≠p n·ªôi dung, h·ªá th·ªëng s·∫Ω gi√∫p b·∫°n t·ªëi ∆∞u h√≥a vi·ªác h·ªçc!</p>
        <button 
          nz-button 
          nzType="primary" 
          nzSize="large"
          (click)="openAddCardModal()"
          style="margin-top: 16px;">
          <span nz-icon nzType="plus" nzTheme="outline"></span>
          Th√™m th·∫ª ƒë·∫ßu ti√™n
        </button>
      </div>
    </nz-empty>

    <!-- Cards List v·ªõi improved design -->
    <div *ngIf="!isLoadingCards && cards.length" class="cards-grid">
      <div 
        *ngFor="let card of cards; let i = index"
        class="card-item">
        <div class="card-header">
          <span class="card-number">Th·∫ª #{{ i + 1 }}</span>
          <div class="card-actions">
            <button 
              nz-button 
              nzType="text" 
              nzSize="small"
              class="action-btn edit-btn"
              (click)="openEditCardModal(card)"
              nz-tooltip="Ch·ªânh s·ª≠a th·∫ª">
              <span nz-icon nzType="edit" nzTheme="outline"></span>
            </button>
            <button 
              nz-button 
              nzType="text"
              nzSize="small"
              class="action-btn delete-btn"
              nz-popconfirm
              nzPopconfirmTitle="B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th·∫ª n√†y?"
              nzPopconfirmPlacement="topRight"
              (nzOnConfirm)="deleteCard(card)"
              nz-tooltip="X√≥a th·∫ª">
              <span nz-icon nzType="delete" nzTheme="outline"></span>
            </button>
          </div>
        </div>
        
        <div class="card-content">
          <div class="card-side front-side">
            <div class="side-label">
              <span nz-icon nzType="eye" nzTheme="outline"></span>
              M·∫∑t tr∆∞·ªõc
            </div>
            <div class="side-content">{{ card.frontText }}</div>
          </div>
          
          <div class="card-divider">
            <span nz-icon nzType="arrow-right" nzTheme="outline"></span>
          </div>
          
          <div class="card-side back-side">
            <div class="side-label">
              <span nz-icon nzType="bulb" nzTheme="outline"></span>
              M·∫∑t sau
            </div>
            <div class="side-content">{{ card.backText }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress hint khi c√≥ 1-4 th·∫ª -->
    <div *ngIf="!isLoadingCards && cards.length > 0 && cards.length < 5" class="progress-hint">
      <div class="hint-card">
        <span nz-icon nzType="info-circle" nzTheme="outline" class="hint-icon"></span>
        <div class="hint-content">
          <h4>üéØ Ti·∫øn ƒë·ªô: {{ cards.length }}/5 th·∫ª</h4>
          <p>Th√™m {{ 5 - cards.length }} th·∫ª n·ªØa l√† b·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu chinh ph·ª•c r·ªìi! üöÄ</p>
        </div>
      </div>
    </div>

    <!-- Ready to conquer khi c√≥ ƒë·ªß 5+ th·∫ª -->
    <div *ngIf="!isLoadingCards && cards.length >= 5" class="ready-hint">
      <div class="hint-card success">
        <span nz-icon nzType="check-circle" nzTheme="outline" class="hint-icon"></span>
        <div class="hint-content">
          <h4>‚úÖ B·ªô th·∫ª ƒë√£ s·∫µn s√†ng!</h4>
          <p>B·∫°n ƒë√£ c√≥ {{ cards.length }} th·∫ª. ƒê√£ ƒë·∫øn l√∫c chinh ph·ª•c ch√∫ng!</p>
        </div>
      </div>
    </div>
    </nz-tab>

    <!-- üë• MEMBERS TAB -->
    <nz-tab>
      <span nz-tab-link>
        <span nz-icon nzType="team" nzTheme="outline"></span>
        Th√†nh vi√™n
        <nz-badge [nzCount]="memberCount" [nzOverflowCount]="999" nzShowZero></nz-badge>
      </span>

      <div class="members-section">
        <div class="section-header">
          <div class="section-title">
            <h2>
              <span nz-icon nzType="team" nzTheme="outline" class="title-icon"></span>
              Th√†nh vi√™n b·ªô th·∫ª
            </h2>
          </div>
          <button 
            nz-button 
            nzType="primary" 
            nzSize="large"
            class="invite-btn"
            (click)="openInviteModal()">
            <span nz-icon nzType="user-add" nzTheme="outline"></span>
            M·ªùi th√†nh vi√™n
          </button>
        </div>

        <!-- Loading -->
        <div *ngIf="isLoadingMembers" class="loading-container">
          <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
          <p>ƒêang t·∫£i danh s√°ch th√†nh vi√™n...</p>
        </div>

        <!-- Empty State -->
        <nz-empty 
          *ngIf="!isLoadingMembers && !members.length"
          nzNotFoundImage="simple"
          class="empty-state">
          <div nz-empty-footer class="empty-message">
            <h3>üë• Ch∆∞a c√≥ th√†nh vi√™n n√†o</h3>
            <p>H√£y m·ªùi b·∫°n b√® c√πng h·ªçc ƒë·ªÉ tƒÉng ƒë·ªông l·ª±c!</p>
            <button 
              nz-button 
              nzType="primary" 
              nzSize="large"
              (click)="openInviteModal()"
              style="margin-top: 16px;">
              <span nz-icon nzType="user-add" nzTheme="outline"></span>
              M·ªùi th√†nh vi√™n ƒë·∫ßu ti√™n
            </button>
          </div>
        </nz-empty>

        <!-- Members Grid -->
        <div *ngIf="!isLoadingMembers && members.length" class="members-grid">
          <div 
            *ngFor="let member of members"
            class="member-card"
            [class.is-owner]="isOwner(member)">
            
            <div class="member-header">
              <nz-avatar 
                [nzSize]="64"
                [nzText]="getUserInitials(member.userName)"
                [ngStyle]="{'background-color': getAvatarColor(member.userId)}">
              </nz-avatar>
              
              <nz-tag 
                *ngIf="isOwner(member)"
                [nzColor]="'gold'"
                class="role-badge">
                <span nz-icon nzType="crown" nzTheme="fill"></span>
                Owner
              </nz-tag>
              <nz-tag 
                *ngIf="!isOwner(member)"
                [nzColor]="'blue'"
                class="role-badge">
                <span nz-icon nzType="user" nzTheme="outline"></span>
                Member
              </nz-tag>
            </div>

            <div class="member-info">
              <h3 class="member-name">{{ member.userName }}</h3>
              <p class="member-email">{{ member.userEmail }}</p>
              <p class="member-joined">
                <span nz-icon nzType="calendar" nzTheme="outline"></span>
                Tham gia {{ member.joinedAt | date: 'dd/MM/yyyy' }}
              </p>
            </div>

            <div class="member-actions">
              <button 
                nz-button 
                nzType="primary"
                nzSize="large"
                nzDanger
                class="challenge-btn"
                (click)="createChallenge(member)"
                *ngIf="!isOwner(member)">
                <span nz-icon nzType="fire" nzTheme="fill"></span>
                Th√°ch ƒë·∫•u
              </button>

              <button 
                nz-button 
                nzType="default"
                nzDanger
                nz-popconfirm
                nzPopconfirmTitle="X√≥a th√†nh vi√™n n√†y kh·ªèi b·ªô th·∫ª?"
                (nzOnConfirm)="removeMember(member)"
                *ngIf="!isOwner(member)">
                <span nz-icon nzType="delete" nzTheme="outline"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </nz-tab>
  </nz-tabset>
</div>

<!-- üìß INVITE MODAL -->
<nz-modal
  [(nzVisible)]="isInviteModalVisible"
  nzTitle="M·ªùi th√†nh vi√™n m·ªõi"
  nzCentered
  [nzOkLoading]="isInviting"
  (nzOnCancel)="handleInviteCancel()"
  (nzOnOk)="sendInvitation()"
  nzOkText="G·ª≠i l·ªùi m·ªùi"
  nzCancelText="H·ªßy"
  nzWidth="500px"
  nzClassName="invite-modal">
  
  <div *nzModalContent>
    <div class="invite-modal-content">
      <div class="modal-icon">
        <span nz-icon nzType="mail" nzTheme="outline"></span>
      </div>
      
      <p class="modal-description">
        Nh·∫≠p email ng∆∞·ªùi d√πng b·∫°n mu·ªën m·ªùi v√†o b·ªô th·∫ª <strong>{{ deck?.name }}</strong>
      </p>

      <form nz-form [formGroup]="inviteForm" class="invite-form">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzRequired>Email</nz-form-label>
          <nz-form-control 
            [nzSpan]="24"
            nzErrorTip="Vui l√≤ng nh·∫≠p email h·ª£p l·ªá">
            <nz-input-group nzSize="large" [nzPrefix]="prefixTemplate">
              <input
                nz-input
                formControlName="email"
                placeholder="example@gmail.com"
                type="email" />
            </nz-input-group>
            <ng-template #prefixTemplate>
              <span nz-icon nzType="mail" nzTheme="outline"></span>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </form>

      <div class="invite-tips">
        <p><span nz-icon nzType="info-circle" nzTheme="outline"></span> Email ph·∫£i ƒë√£ ƒëƒÉng k√Ω trong h·ªá th·ªëng</p>
      </div>
    </div>
  </div>
</nz-modal>



