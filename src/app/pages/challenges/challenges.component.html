<!-- üéÆ CHALLENGES PAGE - PREMIUM UI/UX -->
<div class="challenges-container">
  <!-- Header -->
  <div class="page-header">
    <button nz-button nzType="text" (click)="goBack()" class="back-btn">
      <span nz-icon nzType="arrow-left"></span>
      Quay l·∫°i
    </button>
  </div>

  <!-- Title Section -->
  <div class="title-section">
    <div class="title-content">
      <h1 class="page-title">
        <span nz-icon nzType="trophy" nzTheme="twotone" class="title-icon"></span>
        Th√°ch ƒë·∫•u
      </h1>
      <p class="page-subtitle">
        Thi ƒë·∫•u v·ªõi b·∫°n b√® ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c v√† c·∫£i thi·ªán k·ªπ nƒÉng
      </p>
    </div>
    <div class="title-actions">
      <button nz-button nzType="primary" nzSize="large" 
              (click)="createNewChallenge()" 
              class="create-challenge-btn">
        <span nz-icon nzType="plus-circle" nzTheme="outline"></span>
        T·∫°o th√°ch ƒë·∫•u
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    <p>ƒêang t·∫£i th√°ch ƒë·∫•u...</p>
  </div>

  <!-- Tabs Navigation -->
  <nz-tabset *ngIf="!isLoading" 
             [(nzSelectedIndex)]="selectedTab" 
             (nzSelectedIndexChange)="onTabChange($event)"
             class="challenges-tabs">
    
    <!-- Pending Tab -->
    <nz-tab [nzTitle]="pendingTabTitle">
      <ng-template #pendingTabTitle>
        <div class="tab-title">
          <span nz-icon nzType="clock-circle" class="tab-icon"></span>
          <span>Ch·ªù ph·∫£n h·ªìi</span>
          <nz-badge [nzCount]="pendingChallenges.length" [nzShowZero]="false" class="tab-badge"></nz-badge>
        </div>
      </ng-template>

      <!-- Empty State -->
      <div *ngIf="pendingChallenges.length === 0" class="empty-state">
        <div class="empty-icon">
          <span nz-icon nzType="inbox" nzTheme="twotone"></span>
        </div>
        <div class="empty-message">
          <h3>Kh√¥ng c√≥ th√°ch ƒë·∫•u ch·ªù ph·∫£n h·ªìi</h3>
          <p>B·∫°n ch∆∞a nh·∫≠n ƒë∆∞·ª£c th√°ch ƒë·∫•u n√†o t·ª´ b·∫°n b√®.</p>
          <p class="tip">M·ªùi b·∫°n b√® tham gia v√† t·∫°o th√°ch ƒë·∫•u m·ªõi! üéØ</p>
        </div>
      </div>

      <!-- Pending Challenges List -->
      <div *ngIf="pendingChallenges.length > 0" class="challenges-list">
        <nz-card *ngFor="let challenge of pendingChallenges" class="challenge-card pending-card">
          <div class="card-content">
            <!-- Challenger Info -->
            <div class="challenger-section">
              <div class="challenger-label">Th√°ch ƒë·∫•u t·ª´</div>
              <div class="challenger-info">
                <nz-avatar 
                  [nzSize]="56"
                  [ngStyle]="{'background-color': getAvatarColor(challenge.challenger?.displayName || 'Unknown')}"
                  class="challenger-avatar">
                  {{ getUserInitials(challenge.challenger?.displayName || 'U') }}
                </nz-avatar>
                <div class="challenger-details">
                  <div class="challenger-name">{{ challenge.challenger?.displayName || 'Kh√¥ng r√µ t√™n' }}</div>
                  <div class="challenger-email">{{ challenge.challenger?.email || 'Kh√¥ng c√≥ email' }}</div>
                  <div class="challenge-time">
                    <span nz-icon nzType="clock-circle"></span>
                    {{ formatDate(challenge.createdAt) }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Challenge Info -->
            <div class="challenge-info-section">
              <div class="deck-info">
                <div class="deck-icon">
                  <span nz-icon nzType="book" nzTheme="twotone"></span>
                </div>
                <div class="deck-details">
                  <div class="deck-name">{{ challenge.deck?.name || 'Kh√¥ng r√µ t√™n b·ªô th·∫ª' }}</div>
                  <div class="deck-description">{{ (challenge.deck?.cardCount || 0) + " th·∫ª" }}</div>
                </div>
              </div>

              <div class="challenge-stats">
                <div class="stat-item">
                  <span nz-icon nzType="question-circle"></span>
                  <span class="stat-value">{{ challenge.totalQuestions }}</span>
                  <span class="stat-label">c√¢u h·ªèi</span>
                </div>
                <div class="stat-item">
                  <span nz-icon nzType="clock-circle"></span>
                  <span class="stat-value">{{ challenge.timeLimit }}</span>
                  <span class="stat-label">gi√¢y</span>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="challenge-actions">
              <nz-tag [nzColor]="getStatusColor(challenge.status)" class="status-tag">
                {{ getStatusText(challenge.status) }}
              </nz-tag>
              <div class="action-buttons">
                <button nz-button nzType="primary" nzSize="large"
                        (click)="acceptChallenge(challenge)"
                        class="accept-btn">
                  <span nz-icon nzType="check-circle"></span>
                  Ch·∫•p nh·∫≠n
                </button>
                <button nz-button nzType="default" nzSize="large" nzDanger
                        (click)="rejectChallenge(challenge)"
                        class="reject-btn">
                  <span nz-icon nzType="close-circle"></span>
                  T·ª´ ch·ªëi
                </button>
              </div>
            </div>
          </div>
        </nz-card>
      </div>
    </nz-tab>

    <!-- Active Tab -->
    <nz-tab [nzTitle]="activeTabTitle">
      <ng-template #activeTabTitle>
        <div class="tab-title">
          <span nz-icon nzType="fire" nzTheme="twotone" class="tab-icon"></span>
          <span>ƒêang di·ªÖn ra</span>
          <nz-badge [nzCount]="activeChallenges.length" [nzShowZero]="false" class="tab-badge"></nz-badge>
        </div>
      </ng-template>

      <!-- Empty State -->
      <div *ngIf="activeChallenges.length === 0" class="empty-state">
        <div class="empty-icon">
          <span nz-icon nzType="fire" nzTheme="twotone" [nzTwotoneColor]="'#ff6b6b'"></span>
        </div>
        <div class="empty-message">
          <h3>Kh√¥ng c√≥ th√°ch ƒë·∫•u ƒëang di·ªÖn ra</h3>
          <p>Ch·∫•p nh·∫≠n th√°ch ƒë·∫•u ho·∫∑c t·∫°o th√°ch ƒë·∫•u m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
        </div>
      </div>

      <!-- Active Challenges List -->
      <div *ngIf="activeChallenges.length > 0" class="challenges-list">
        <nz-card *ngFor="let challenge of activeChallenges" class="challenge-card active-card">
          <div class="card-content">
            <!-- Opponent Info -->
            <div class="challenger-section">
              <div class="challenger-label">
                {{ isChallenger(challenge) ? 'ƒê·ªëi th·ªß' : 'Th√°ch ƒë·∫•u t·ª´' }}
              </div>
              <div class="challenger-info">
                <nz-avatar 
                  [nzSize]="56"
                  [ngStyle]="{'background-color': getAvatarColor(getOpponentInfo(challenge)?.displayName || 'Unknown')}"
                  class="challenger-avatar">
                  {{ getUserInitials(getOpponentInfo(challenge)?.displayName || 'U') }}
                </nz-avatar>
                <div class="challenger-details">
                  <div class="challenger-name">
                    {{ getOpponentInfo(challenge)?.displayName || 'Kh√¥ng r√µ t√™n' }}
                  </div>
                  <div class="challenger-email">
                    {{ getOpponentInfo(challenge)?.email || 'Kh√¥ng c√≥ email' }}
                  </div>
                  <div class="challenge-time">
                    <span nz-icon nzType="calendar"></span>
                    B·∫Øt ƒë·∫ßu: {{ formatDate(challenge.createdAt) }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Challenge Info -->
            <div class="challenge-info-section">
              <div class="deck-info">
                <div class="deck-icon">
                  <span nz-icon nzType="book" nzTheme="twotone"></span>
                </div>
                <div class="deck-details">
                  <div class="deck-name">{{ challenge.deck?.name || 'Kh√¥ng r√µ t√™n b·ªô th·∫ª' }}</div>
                </div>
              </div>

              <div class="challenge-stats">
                <div class="stat-item">
                  <span nz-icon nzType="question-circle"></span>
                  <span class="stat-value">{{ challenge.totalQuestions }}</span>
                  <span class="stat-label">c√¢u</span>
                </div>
              </div>

              <!-- Progress Info -->
              <div class="progress-info" *ngIf="challenge.challengerScore !== null || challenge.opponentScore !== null">
                <div class="score-item" *ngIf="challenge.challengerScore !== null">
                  <span class="score-label">ƒêi·ªÉm challenger:</span>
                  <span class="score-value">{{ challenge.challengerScore }}/{{ challenge.totalQuestions }}</span>
                </div>
                <div class="score-item" *ngIf="challenge.opponentScore !== null">
                  <span class="score-label">ƒêi·ªÉm opponent:</span>
                  <span class="score-value">{{ challenge.opponentScore }}/{{ challenge.totalQuestions }}</span>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="challenge-actions">
              <nz-tag [nzColor]="getStatusColor(challenge.status)" class="status-tag">
                {{ getStatusText(challenge.status) }}
              </nz-tag>
              <button nz-button nzType="primary" nzSize="large"
                      (click)="startChallenge(challenge)"
                      class="start-btn">
                <span nz-icon nzType="play-circle"></span>
                B·∫Øt ƒë·∫ßu thi
              </button>
            </div>
          </div>
        </nz-card>
      </div>
    </nz-tab>

    <!-- Completed Tab -->
    <nz-tab [nzTitle]="completedTabTitle">
      <ng-template #completedTabTitle>
        <div class="tab-title">
          <span nz-icon nzType="check-circle" nzTheme="twotone" class="tab-icon"></span>
          <span>Ho√†n th√†nh</span>
          <nz-badge [nzCount]="completedChallenges.length" [nzShowZero]="false" class="tab-badge"></nz-badge>
        </div>
      </ng-template>

      <!-- Empty State -->
      <div *ngIf="completedChallenges.length === 0" class="empty-state">
        <div class="empty-icon">
          <span nz-icon nzType="trophy" nzTheme="twotone" [nzTwotoneColor]="'#ffd700'"></span>
        </div>
        <div class="empty-message">
          <h3>Ch∆∞a c√≥ th√°ch ƒë·∫•u ho√†n th√†nh</h3>
          <p>Ho√†n th√†nh c√°c th√°ch ƒë·∫•u ƒë·ªÉ xem k·∫øt qu·∫£ v√† th·ªëng k√™!</p>
        </div>
      </div>

      <!-- Completed Challenges List -->
      <div *ngIf="completedChallenges.length > 0" class="challenges-list">
        <nz-card *ngFor="let challenge of completedChallenges" class="challenge-card completed-card">
          <div class="card-content">
            <!-- Challenge Result Banner -->
            <div class="result-banner" 
                 [ngClass]="{
                   'win-banner': getChallengeResult(challenge).result === 'win',
                   'lose-banner': getChallengeResult(challenge).result === 'lose',
                   'tie-banner': getChallengeResult(challenge).result === 'tie'
                 }">
              <span nz-icon 
                    [nzType]="getChallengeResult(challenge).result === 'win' ? 'trophy' : 
                             getChallengeResult(challenge).result === 'lose' ? 'frown' : 'crown'"
                    nzTheme="fill"></span>
              <span class="result-text">
                {{ getChallengeResult(challenge).result === 'win' ? 'Chi·∫øn th·∫Øng!' : 
                   getChallengeResult(challenge).result === 'lose' ? 'Th·∫•t b·∫°i' : 'H√≤a' }}
              </span>
            </div>

            <!-- Opponent Info -->
            <div class="challenger-section">
              <div class="challenger-label">ƒê·ªëi th·ªß</div>
              <div class="challenger-info">
                <nz-avatar 
                  [nzSize]="56"
                  [ngStyle]="{'background-color': getAvatarColor(getOpponentInfo(challenge)?.displayName || 'Unknown')}"
                  class="challenger-avatar">
                  {{ getUserInitials(getOpponentInfo(challenge)?.displayName || 'U') }}
                </nz-avatar>
                <div class="challenger-details">
                  <div class="challenger-name">
                    {{ getOpponentInfo(challenge)?.displayName || 'Kh√¥ng r√µ t√™n' }}
                  </div>
                  <div class="challenger-email">
                    {{ getOpponentInfo(challenge)?.email || 'Kh√¥ng c√≥ email' }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Challenge Info -->
            <div class="challenge-info-section">
              <div class="deck-info">
                <div class="deck-icon">
                  <span nz-icon nzType="book" nzTheme="twotone"></span>
                </div>
                <div class="deck-details">
                  <div class="deck-name">{{ challenge.deck?.name || 'Kh√¥ng r√µ t√™n b·ªô th·∫ª' }}</div>
                  <div class="deck-description">{{ (challenge.deck?.cardCount || 0) + " th·∫ª" }}</div>
                </div>
              </div>

              <!-- Score Comparison -->
              <div class="score-comparison">
                <div class="score-item your-score">
                  <div class="score-label">ƒêi·ªÉm c·ªßa b·∫°n</div>
                  <div class="score-value">
                    {{ getChallengeResult(challenge).userScore }}/{{ challenge.totalQuestions }}
                  </div>
                </div>
                <div class="vs-divider">VS</div>
                <div class="score-item opponent-score">
                  <div class="score-label">ƒêi·ªÉm ƒë·ªëi th·ªß</div>
                  <div class="score-value">
                    {{ getChallengeResult(challenge).opponentScore }}/{{ challenge.totalQuestions }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="challenge-actions">
              <nz-tag [nzColor]="getStatusColor(challenge.status)" class="status-tag">
                {{ getStatusText(challenge.status) }}
              </nz-tag>
              <div class="action-buttons">
                <button nz-button nzType="default" nzSize="large"
                        (click)="viewResult(challenge)"
                        class="view-result-btn">
                  <span nz-icon nzType="eye"></span>
                  Xem chi ti·∫øt
                </button>
              </div>
            </div>
          </div>
        </nz-card>
      </div>
    </nz-tab>
  </nz-tabset>

  <!-- Tips Section -->
  <div *ngIf="!isLoading" class="tips-section">
    <nz-card class="tips-card">
      <div class="tips-content">
        <span nz-icon nzType="bulb" nzTheme="twotone" [nzTwotoneColor]="'#faad14'" class="tips-icon"></span>
        <div class="tips-text">
          <h4>üí° M·∫πo thi ƒë·∫•u</h4>
          <ul>
            <li>Ch·∫•p nh·∫≠n th√°ch ƒë·∫•u ƒë·ªÉ c·∫£i thi·ªán k·ªπ nƒÉng v√† ki·ªÉm tra ki·∫øn th·ª©c</li>
            <li>T·ªëc ƒë·ªô tr·∫£ l·ªùi ·∫£nh h∆∞·ªüng ƒë·∫øn k·∫øt qu·∫£ khi ƒëi·ªÉm b·∫±ng nhau</li>
            <li>Xem l·∫°i k·∫øt qu·∫£ ƒë·ªÉ h·ªçc h·ªèi t·ª´ nh·ªØng sai l·∫ßm</li>
            <li>Th√°ch ƒë·∫•u b·∫°n b√® th∆∞·ªùng xuy√™n ƒë·ªÉ duy tr√¨ ƒë·ªông l·ª±c h·ªçc t·∫≠p</li>
          </ul>
        </div>
      </div>
    </nz-card>
  </div>
</div>
