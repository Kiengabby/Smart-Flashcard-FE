<div class="flashcard-study-container">
  <!-- Header -->
  <div class="study-header">
    <button nz-button nzType="text" (click)="goBack()" class="back-btn">
      <span nz-icon nzType="close" nzTheme="outline"></span>
    </button>
    <div class="progress-info">
      <span class="card-count">{{ currentIndex + 1 }} / {{ cards.length }}</span>
    </div>
    <button nz-button nzType="text" (click)="restart()" class="restart-btn">
      <span nz-icon nzType="reload" nzTheme="outline"></span>
    </button>
  </div>

  <!-- Progress Bar -->
  <div class="progress-bar-container">
    <nz-progress
      [nzPercent]="progress"
      [nzShowInfo]="false"
      nzStrokeColor="#52c41a"
      [nzStrokeWidth]="8">
    </nz-progress>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <span nz-icon nzType="loading" nzTheme="outline"></span>
    </div>
    <p>Đang tải thẻ học...</p>
  </div>

  <!-- Flashcard -->
  <div *ngIf="!isLoading && currentCard" class="flashcard-wrapper">
    <div 
      class="flashcard" 
      [class.flipped]="isFlipped"
      (click)="flipCard()">
      <div class="flashcard-inner">
        <!-- Front Side -->
        <div class="flashcard-face flashcard-front">
          <div class="face-label">Mặt trước</div>
          <div class="face-content">
            <div class="word-container">
              <p class="card-text" [ngClass]="getTextSizeClass(currentCard.frontText)">{{ currentCard.frontText }}</p>
              <!-- Modern Audio Button -->
              <button 
                class="audio-button"
                (click)="playAudio(); $event.stopPropagation()"
                [class.loading]="isAudioLoading"
                nz-tooltip="Nghe phát âm"
                nzTooltipPlacement="top">
                <div class="audio-icon">
                  <span *ngIf="!isAudioLoading" nz-icon nzType="sound" nzTheme="outline"></span>
                  <span *ngIf="isAudioLoading" nz-icon nzType="loading" nzTheme="outline" class="spinning"></span>
                </div>
                <div class="audio-waves" [class.active]="isAudioLoading">
                  <div class="wave wave-1"></div>
                  <div class="wave wave-2"></div>
                  <div class="wave wave-3"></div>
                </div>
              </button>
            </div>
          </div>
          <div class="face-hint">
            <span nz-icon nzType="eye" nzTheme="outline"></span>
            Nhấn để xem câu trả lời
          </div>
        </div>

        <!-- Back Side -->
        <div class="flashcard-face flashcard-back">
          <div class="face-label">Mặt sau</div>
          <div class="face-content">
            <p class="card-text" [ngClass]="getTextSizeClass(currentCard.backText)">{{ currentCard.backText }}</p>
          </div>
          <div class="face-hint">
            <span nz-icon nzType="eye-invisible" nzTheme="outline"></span>
            Nhấn để ẩn câu trả lời
          </div>
        </div>
      </div>
    </div>

    <!-- Hint Text -->
    <p class="flip-hint">
      <span nz-icon nzType="info-circle" nzTheme="outline"></span>
      Nhấn vào thẻ để lật và xem câu trả lời
    </p>
  </div>

  <!-- Controls -->
  <div *ngIf="!isLoading && currentCard" class="study-controls">
    <!-- SM-2 Difficulty Rating - Always visible -->
    <div class="difficulty-rating">
      <p class="rating-label">Đánh giá mức độ khó của từ này:</p>
      <div class="rating-buttons">
        <button 
          nz-button 
          nzSize="large"
          class="btn-easy"
          (click)="rateCard(5)">
          <span nz-icon nzType="smile" nzTheme="outline"></span>
          Dễ
        </button>
        <button 
          nz-button 
          nzSize="large"
          class="btn-medium"
          (click)="rateCard(3)">
          <span nz-icon nzType="meh" nzTheme="outline"></span>
          Trung bình
        </button>
        <button 
          nz-button 
          nzSize="large"
          class="btn-hard"
          (click)="rateCard(1)">
          <span nz-icon nzType="frown" nzTheme="outline"></span>
          Khó
        </button>
        <button 
          nz-button 
          nzSize="large"
          class="btn-known"
          (click)="rateCard(4)">
          <span nz-icon nzType="check-circle" nzTheme="outline"></span>
          Đã biết
        </button>
      </div>
    </div>

    <!-- Flip Instruction - Show hint to flip card if not flipped -->
    <div class="flip-instruction" *ngIf="!isFlipped">
      <p class="instruction-text">
        <span nz-icon nzType="eye" nzTheme="outline"></span>
        Nhấn vào thẻ để xem câu trả lời (không bắt buộc)
      </p>
    </div>

    <!-- Navigation -->
    <div class="navigation-controls">
      <button 
        nz-button 
        nzType="default"
        [disabled]="isFirstCard"
        (click)="previousCard()">
        <span nz-icon nzType="left" nzTheme="outline"></span>
        Trước
      </button>
      <button 
        nz-button 
        nzType="default"
        [disabled]="isLastCard"
        (click)="nextCard()">
        Sau
        <span nz-icon nzType="right" nzTheme="outline"></span>
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !cards.length" class="empty-state">
    <span nz-icon nzType="inbox" nzTheme="outline"></span>
    <h3>Không có thẻ nào để học</h3>
    <p>Hãy thêm thẻ vào bộ thẻ trước khi bắt đầu học!</p>
    <button nz-button nzType="primary" (click)="goBack()">
      Quay lại
    </button>
  </div>
</div>

