<div class="daily-review-container">
  
  <!-- ==================== OVERVIEW SCREEN ==================== -->
  <div *ngIf="currentView === 'overview'" class="overview-screen">
    
    <!-- Header -->
    <div class="overview-header">
      <button nz-button nzType="text" (click)="goBack()" class="back-btn">
        <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
      </button>
      <h1 class="page-title">√în t·∫≠p h√†ng ng√†y</h1>
      <div class="header-spacer"></div>
    </div>

    <!-- Loading State -->
    <div *ngIf="overviewLoading" class="overview-loading">
      <div class="loading-spinner">
        <span nz-icon nzType="loading" nzTheme="outline"></span>
      </div>
      <p>ƒêang t·∫£i th·ªëng k√™...</p>
    </div>

    <!-- Overview Content -->
    <div *ngIf="!overviewLoading && overview" class="overview-content">
      
      <!-- Streak Card -->
      <div class="streak-card">
        <div class="streak-icon">
          <span nz-icon nzType="fire" nzTheme="fill"></span>
        </div>
        <div class="streak-info">
          <div class="streak-number">{{ overview.currentStreak || 0 }}</div>
          <div class="streak-label">Ng√†y li√™n ti·∫øp</div>
        </div>
        <div class="streak-badge" *ngIf="overview.hasStudiedToday">
          <span nz-icon nzType="check-circle" nzTheme="fill"></span>
          H√¥m nay
        </div>
      </div>

      <!-- Statistics Grid -->
      <div class="stats-grid">
        <!-- Total Due Today -->
        <div class="stat-card primary">
          <div class="stat-icon">
            <span nz-icon nzType="book" nzTheme="outline"></span>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ overview.totalDue || 0 }}</div>
            <div class="stat-label">T·ªïng th·∫ª h√¥m nay</div>
          </div>
        </div>

        <!-- Overdue Cards -->
        <div class="stat-card danger">
          <div class="stat-icon">
            <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ overview.overdueCards || 0 }}</div>
            <div class="stat-label">Th·∫ª qu√° h·∫°n</div>
          </div>
        </div>

        <!-- New Cards -->
        <div class="stat-card info">
          <div class="stat-icon">
            <span nz-icon nzType="star" nzTheme="outline"></span>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ overview.newCards || 0 }}</div>
            <div class="stat-label">Th·∫ª m·ªõi</div>
          </div>
        </div>

        <!-- Estimated Time -->
        <div class="stat-card success">
          <div class="stat-icon">
            <span nz-icon nzType="field-time" nzTheme="outline"></span>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ Math.ceil((overview.estimatedTime || 0) / 60) }}</div>
            <div class="stat-label">Ph√∫t ∆∞·ªõc t√≠nh</div>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      <div class="recommendation-card" *ngIf="overview.recommendations">
        <div class="recommendation-icon">
          <span nz-icon nzType="bulb" nzTheme="fill"></span>
        </div>
        <div class="recommendation-content">
          <h4>G·ª£i √Ω h·ªçc t·∫≠p</h4>
          <p>{{ overview.recommendations.priority }}</p>
        </div>
      </div>

      <!-- Estimated Time -->
      <div class="time-estimate" *ngIf="overview.estimatedTime">
        <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
        Th·ªùi gian d·ª± ki·∫øn: <strong>{{ (overview.estimatedTime / 60).toFixed(0) }} ph√∫t</strong>
      </div>

      <!-- Start Button -->
      <div class="action-buttons">
        <button 
          nz-button 
          nzType="primary" 
          nzSize="large"
          nzBlock
          (click)="startReview()"
          [disabled]="!overview.totalDue || overview.totalDue === 0"
          class="start-btn">
          <span nz-icon nzType="play-circle" nzTheme="fill"></span>
          B·∫Øt ƒë·∫ßu √¥n t·∫≠p
        </button>
      </div>

      <!-- No Cards Message -->
      <div class="no-cards-message" *ngIf="overview.totalDue === 0">
        <div class="success-icon">
          <span nz-icon nzType="check-circle" nzTheme="fill"></span>
        </div>
        <h3>Xu·∫•t s·∫Øc!</h3>
        <p>B·∫°n ƒë√£ ho√†n th√†nh h·∫øt th·∫ª c·∫ßn √¥n t·∫≠p h√¥m nay</p>
        <p class="sub-message">H√£y quay l·∫°i v√†o ng√†y mai ƒë·ªÉ ti·∫øp t·ª•c!</p>
      </div>
    </div>
  </div>

  <!-- ==================== REVIEW SCREEN ==================== -->
  <div *ngIf="currentView === 'review'" class="review-screen">
    
    <!-- Header -->
    <div class="study-header">
      <button nz-button nzType="text" (click)="goBack()" class="back-btn">
        <span nz-icon nzType="close" nzTheme="outline"></span>
      </button>
      <div class="progress-info">
        <span class="card-count">{{ currentIndex + 1 }} / {{ cards.length }}</span>
      </div>
      <button nz-button nzType="text" (click)="restart()" class="restart-btn" nz-tooltip="B·∫Øt ƒë·∫ßu l·∫°i">
        <span nz-icon nzType="reload" nzTheme="outline"></span>
      </button>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar-container">
      <nz-progress
        [nzPercent]="progress"
        [nzShowInfo]="false"
        nzStrokeColor="#52c41a"
        [nzStrokeWidth]="8">
      </nz-progress>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner">
        <span nz-icon nzType="loading" nzTheme="outline"></span>
      </div>
      <p>ƒêang t·∫£i th·∫ª √¥n t·∫≠p...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && cards.length === 0" class="empty-container">
      <nz-empty
        nzNotFoundImage="simple"
        nzNotFoundContent="Kh√¥ng c√≥ th·∫ª n√†o c·∫ßn √¥n t·∫≠p">
        <p class="empty-subtitle">üéâ Tuy·ªát v·ªùi! B·∫°n ƒë√£ ho√†n th√†nh h·∫øt!</p>
        <button nz-button nzType="primary" nzSize="large" (click)="goBack()">
          <span nz-icon nzType="home"></span>
          V·ªÅ trang ch·ªß
        </button>
      </nz-empty>
    </div>

    <!-- Flashcard -->
    <div *ngIf="!isLoading && currentCard" class="flashcard-wrapper">
      <div 
        class="flashcard" 
        [class.flipped]="isFlipped"
        (click)="flipCard()">
        <div class="flashcard-inner">
          
          <!-- Front Side -->
          <div class="flashcard-face flashcard-front">
            <div class="face-label">C√¢u h·ªèi</div>
            <div class="face-content">
              <div class="word-container">
                <p class="card-text" [ngClass]="getTextSizeClass(currentCard.front)">
                  {{ currentCard.front }}
                </p>
              </div>
            </div>
            <div class="flip-hint" *ngIf="!isFlipped">
              <span nz-icon nzType="swap" nzTheme="outline"></span>
              <span>Nh·∫•n ƒë·ªÉ xem ƒë√°p √°n</span>
            </div>
          </div>

          <!-- Back Side -->
          <div class="flashcard-face flashcard-back">
            <div class="face-label">ƒê√°p √°n</div>
            <div class="face-content">
              <div class="word-container">
                <p class="card-text" [ngClass]="getTextSizeClass(currentCard.back)">
                  {{ currentCard.back }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Card Info Badge -->
      <div class="card-info-badge" *ngIf="currentCard">
        <span class="difficulty-badge" [ngClass]="getDifficultyColor()">
          {{ getDifficultyText() }}
        </span>
      </div>
    </div>

    <!-- Rating Buttons - Simplified (No time labels) -->
    <div *ngIf="!isLoading && currentCard && isFlipped" class="rating-container">
      <div class="rating-title">üí° ƒê√°nh gi√° m·ª©c ƒë·ªô nh·ªõ c·ªßa b·∫°n</div>
      <div class="rating-buttons anki-style">
        <!-- Again - Failed -->
        <button 
          nz-button 
          nzType="default"
          class="quality-btn quality-again"
          (click)="rateCard(1); $event.stopPropagation()"
          nz-tooltip="Qu√™n ho√†n to√†n - C·∫ßn h·ªçc l·∫°i">
          <div class="quality-content">
            <span nz-icon nzType="close-circle" nzTheme="fill" class="quality-icon"></span>
            <span class="quality-label">Qu√™n</span>
          </div>
        </button>

        <!-- Hard -->
        <button 
          nz-button 
          nzType="default"
          class="quality-btn quality-hard"
          (click)="rateCard(3); $event.stopPropagation()"
          nz-tooltip="Nh·ªõ ƒë∆∞·ª£c nh∆∞ng kh√≥ khƒÉn">
          <div class="quality-content">
            <span nz-icon nzType="warning" nzTheme="fill" class="quality-icon"></span>
            <span class="quality-label">Kh√≥</span>
          </div>
        </button>

        <!-- Good -->
        <button 
          nz-button 
          nzType="default"
          class="quality-btn quality-good"
          (click)="rateCard(4); $event.stopPropagation()"
          nz-tooltip="Nh·ªõ t·ªët, t·ª± tin">
          <div class="quality-content">
            <span nz-icon nzType="check-circle" nzTheme="fill" class="quality-icon"></span>
            <span class="quality-label">T·ªët</span>
          </div>
        </button>

        <!-- Easy -->
        <button 
          nz-button 
          nzType="default"
          class="quality-btn quality-easy"
          (click)="rateCard(5); $event.stopPropagation()"
          nz-tooltip="R·∫•t d·ªÖ, kh√¥ng c·∫ßn suy nghƒ©">
          <div class="quality-content">
            <span nz-icon nzType="heart" nzTheme="fill" class="quality-icon"></span>
            <span class="quality-label">D·ªÖ</span>
          </div>
        </button>
      </div>
      <div class="rating-hint">
        <span nz-icon nzType="info-circle" nzTheme="outline"></span>
        <span class="hint-text">Ch·ªçn ch√≠nh x√°c ƒë·ªÉ thu·∫≠t to√°n SM-2 t·ªëi ∆∞u l·ªãch √¥n t·∫≠p cho b·∫°n</span>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div *ngIf="!isLoading && currentCard" class="nav-buttons">
      <button 
        nz-button 
        nzType="default"
        nzSize="large"
        (click)="previousCard(); $event.stopPropagation()"
        [disabled]="isFirstCard"
        class="nav-btn nav-btn-prev">
        <span nz-icon nzType="left" nzTheme="outline"></span>
        <span>Tr∆∞·ªõc</span>
      </button>

      <button 
        nz-button 
        nzType="default"
        nzSize="large"
        (click)="nextCard(); $event.stopPropagation()"
        [disabled]="isLastCard"
        class="nav-btn nav-btn-next">
        <span>Sau</span>
        <span nz-icon nzType="right" nzTheme="outline"></span>
      </button>
    </div>
  </div>
</div>
