<div class="dashboard-container" style="width: 100%;">
  
  <!-- Ph·∫ßn 1: Welcome Header + Quick Stats (75%) -->
  <div class="dashboard-main-section" style="padding: 0 12px 0 0; width: 70%;">

    <div class="welcome-header modern cute-book-bg" [class.minimized]="isWelcomeMinimized">
      <div class="welcome-content">
        <div class="greeting-section">
          <div class="user-greeting">
            <div>
              <i class="fa-regular fa-face-grin-squint greeting-icon"></i>
              <span class="greeting-text">Ch√†o {{ currentUser.name || '' }}!</span>
            </div>
            <div class="motivation-section">
              <p class="welcome-subtitle dynamic">
                <span class="highlight-text">{{ getMotivationalQuote() }}</span>
              </p>
            </div>
          </div>
        </div>
        
        <div class="action-hint">
          <i class="fa-solid fa-lightbulb hint-icon"></i>
          <span class="hint-text">B·∫Øt ƒë·∫ßu v·ªõi vi·ªác √¥n t·∫≠p nh·ªØng th·∫ª ƒë√£ ƒë·∫øn h·∫°n nh√©!</span>
        </div>
      </div>
      
      <div class="close-button" (click)="minimizeWelcome()">
        <span nz-icon nzType="up" nzTheme="outline"></span>
      </div>
    </div>
        <div class="quick-stats" id="stats-overview">
      <nz-row [nzGutter]="[16, 16]">
        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
          <div class="stat-card conquered-decks">
            <div class="stat-icon">
              <i class="fa-solid fa-crown"></i>
            </div>
            <div class="stat-info">
              <div class="stat-value" *ngIf="!isStatsLoading">{{ stats.conqueredDecks }}</div>
              <div class="stat-value" *ngIf="isStatsLoading"><nz-spin nzSize="small"></nz-spin></div>
              <div class="stat-label">B·ªô th·∫ª ƒë√£ chinh ph·ª•c</div>
            </div>
          </div>
        </nz-col>

        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
          <div class="stat-card total-words">
            <div class="stat-icon">
              <i class="fa-solid fa-scroll"></i>
            </div>
            <div class="stat-info">
              <div class="stat-value" *ngIf="!isStatsLoading">{{ stats.totalWordsLearned }}</div>
              <div class="stat-value" *ngIf="isStatsLoading"><nz-spin nzSize="small"></nz-spin></div>
              <div class="stat-label">T·ªïng s·ªë t·ª´ ƒë√£ h·ªçc</div>
            </div>
          </div>
        </nz-col>

        <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8">
          <div class="stat-card review-today" id="review-today-card">
            <div class="stat-icon">
              <i class="fa-solid fa-hourglass-half"></i>
            </div>
            <div class="stat-info">
              <div class="stat-value highlight" *ngIf="!isStatsLoading">{{ stats.reviewToday }}</div>
              <div class="stat-value highlight" *ngIf="isStatsLoading"><nz-spin nzSize="small"></nz-spin></div>
              <div class="stat-label">Th·∫ª c·∫ßn √¥n h√¥m nay</div>
            </div>
          </div>
        </nz-col>
      </nz-row>
    </div>

    
        <div class="dashboard-main-content">
      <div class="content-grid">
        <nz-card class="action-card daily-review-card" >
          <div class="action-content">
            <div class="action-header">
              <i class="fa-solid fa-bell action-icon"></i>
              <div class="action-text">
                <h3>ƒê√£ ƒë·∫øn gi·ªù √¥n t·∫≠p r·ªìi!</h3>
                <p>B·∫°n c√≥ <strong>{{ stats.reviewToday }} th·∫ª</strong> c·∫ßn √¥n t·∫≠p h√¥m nay</p>
              </div>
            </div>
            <button nz-button nzType="primary" nzSize="large" class="action-button" (click)="navigateToDailyReview()">
              <span nz-icon nzType="play-circle" nzTheme="fill"></span>
              B·∫Øt ƒë·∫ßu √în t·∫≠p
            </button>
          </div>
        </nz-card>

        <!-- Invitations Section - Redesigned (Green Theme) -->
        <div *ngIf="!isLoadingInvitations && pendingInvitations.length > 0" class="invitations-section modern-invitations">
          <!-- Section Header -->
          <div class="invitations-header modern-header">
            <div class="header-content">
              <div class="header-icon">
                <i class="fa-solid fa-leaf"></i>
              </div>
              <div class="header-text">
                <h3 class="section-title">L·ªùi m·ªùi h·ªçc c√πng</h3>
                <p class="section-subtitle">{{ pendingInvitations.length }} l·ªùi m·ªùi ƒëang ch·ªù b·∫°n</p>
              </div>
              <div class="header-badge">
                <nz-badge [nzCount]="pendingInvitations.length" 
                          [nzColor]="'#9ccc65'" 
                          class="modern-badge"></nz-badge>
              </div>
            </div>
          </div>
          
          <!-- Invitations Grid -->
          <div class="invitations-grid">
            <div *ngFor="let invitation of pendingInvitations; trackBy: trackByInvitationId" 
                 class="invitation-card modern-card">
              
              <!-- Card Header with Deck Info -->
              <div class="card-header">
                <div class="deck-preview">
                  <div class="deck-icon-wrapper">
                    <i class="fa-solid fa-layer-group deck-icon"></i>
                  </div>
                  <div class="deck-info">
                    <h4 class="deck-title" [title]="invitation.deck.name">{{ invitation.deck.name }}</h4>
                    <div class="deck-meta">
                      <span class="meta-item">
                        <i class="fa-solid fa-credit-card"></i>
                        {{ invitation.deck.cardCount || 0 }} th·∫ª
                      </span>
                      <span class="meta-separator">‚Ä¢</span>
                      <span class="meta-item time">
                        <i class="fa-regular fa-clock"></i>
                        {{ formatTimeAgo(invitation.createdAt) }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Sender Profile -->
              <div class="sender-profile">
                <div class="sender-avatar-wrapper">
                  <nz-avatar 
                    [nzSize]="32"
                    [ngStyle]="{'background': getAvatarGradient(invitation.inviter.name)}"
                    class="sender-avatar modern-avatar">
                    {{ getUserInitials(invitation.inviter.name) }}
                  </nz-avatar>
                </div>
                <div class="sender-info">
                  <div class="sender-name" [title]="invitation.inviter.name">{{ invitation.inviter.name }}</div>
                  <div class="invitation-message">
                    M·ªùi b·∫°n c√πng h·ªçc v√† ti·∫øn b·ªô!
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="invitation-actions modern-actions">
                <button nz-button 
                        nzType="primary" 
                        nzSize="default"
                        [nzLoading]="isInvitationProcessing(invitation.id)"
                        [disabled]="isInvitationProcessing(invitation.id)"
                        (click)="acceptInvitation(invitation)"
                        class="accept-button modern-button">
                  <i class="fa-solid fa-check" *ngIf="!isInvitationProcessing(invitation.id)"></i>
                  <span class="button-text">Ch·∫•p nh·∫≠n</span>
                </button>
                
                <button nz-button 
                        nzType="default" 
                        nzSize="default"
                        [disabled]="isInvitationProcessing(invitation.id)"
                        (click)="rejectInvitation(invitation)"
                        class="reject-button modern-button">
                  <i class="fa-solid fa-times"></i>
                  <span class="button-text">T·ª´ ch·ªëi</span>
                </button>
              </div>

              <!-- Card Footer with Benefits -->
              <div class="card-footer">
                <div class="benefits-preview">
                  <div class="benefit-item">
                    <i class="fa-solid fa-users"></i>
                    <span>H·ªçc c√πng</span>
                  </div>
                  <div class="benefit-item">
                    <i class="fa-solid fa-trophy"></i>
                    <span>Th√°ch ƒë·∫•u</span>
                  </div>
                  <div class="benefit-item">
                    <i class="fa-solid fa-chart-line"></i>
                    <span>Ti·∫øn b·ªô</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State for Invitations (if needed) -->
        <div *ngIf="!isLoadingInvitations && pendingInvitations.length === 0" class="invitations-empty-hint">
          <p class="empty-hint">
            <i class="fa-regular fa-envelope-open"></i>
            Khi c√≥ l·ªùi m·ªùi h·ªçc t·∫≠p t·ª´ b·∫°n b√®, ch√∫ng s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y
          </p>
        </div>
      </div>
    </div>

    
  </div>

  <!-- Ph·∫ßn 2: Dashboard Main Wrapper (25%) -->
  <div class="dashboard-secondary-section" style="width: 30%">
    <!-- Main Content Area -->

    <!-- Right Sidebar for Streak Card -->
    <div class="dashboard-right-sidebar">
      <nz-card class="section-card streak-card compact" [nzTitle]="streakTitle">
        <ng-template #streakTitle>
          <div class="section-header">
            <span nz-icon nzType="fire" nzTheme="fill" style="color: #ff922b;"></span>
            <span class="section-title">Chu·ªói ng√†y h·ªçc</span>
          </div>
        </ng-template>

        <div class="streak-display">
          <div class="streak-number">{{ stats.studyStreak }}</div>
          <div class="streak-label">ng√†y li√™n ti·∫øp</div>
          <div class="streak-message">Tuy·ªát v·ªùi! H√£y ti·∫øp t·ª•c! üí™</div>
        </div>

        <div class="calendar-mini compact">
          <div class="calendar-header">
            <button nz-button nzType="link" nzSize="small" (click)="previousMonth()">
              <span nz-icon nzType="left"></span>
            </button>
            <span class="current-month">Th√°ng {{ currentMonth }}</span>
            <button nz-button nzType="link" nzSize="small" (click)="nextMonth()">
              <span nz-icon nzType="right"></span>
            </button>
          </div>
          
          <div class="calendar-grid">
            <div class="calendar-weekdays">
              <div class="weekday">CN</div>
              <div class="weekday">T2</div>
              <div class="weekday">T3</div>
              <div class="weekday">T4</div>
              <div class="weekday">T5</div>
              <div class="weekday">T6</div>
              <div class="weekday">T7</div>
            </div>
            
            <div class="calendar-days">
              <div 
                *ngFor="let day of calendarDays"
                class="calendar-day"
                [class.other-month]="!day.currentMonth"
                [class.today]="day.isToday"
                [class.has-activity]="day.hasActivity"
                [class.level-1]="day.activityLevel === 1"
                [class.level-2]="day.activityLevel === 2"
                [class.level-3]="day.activityLevel === 3"
              >
                <span class="day-number">{{ day.date }}</span>
                <span nz-icon nzType="fire" nzTheme="fill" class="fire-icon" *ngIf="day.hasActivity"></span>
              </div>
            </div>
          </div>
        </div>
      </nz-card>
    </div>
  </div>

</div>
