<div class="learning-path-container">
  <!-- Header -->
  <div class="path-header">
    <button nz-button nzType="text" (click)="goBack()" class="back-btn">
      <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
      Quay l·∫°i
    </button>
    
    <div class="header-content">
      <div class="header-icon">üéØ</div>
      <div class="header-text">
        <h1 class="page-title">H√†nh Tr√¨nh Chinh Ph·ª•c</h1>
        <p class="page-subtitle" *ngIf="deck">{{ deck.name }}</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <nz-spin nzSize="large" nzTip="ƒêang t·∫£i h√†nh tr√¨nh h·ªçc t·∫≠p..."></nz-spin>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="path-content">
    
    <!-- Overall Progress Card -->
    <nz-card class="progress-overview-card" [nzBordered]="false">
      <div class="progress-overview">
        <div class="progress-stats">
          <div class="stat-item main-stat">
            <div class="stat-icon">
              <div class="progress-circle" 
                   [style.background]="'conic-gradient(' + getProgressColor() + ' ' + overallProgress * 3.6 + 'deg, #e5e7eb 0deg)'">
                <div class="progress-inner">
                  <span class="progress-value">{{ overallProgress }}%</span>
                </div>
              </div>
            </div>
            <div class="stat-info">
              <h3 class="stat-title">Ti·∫øn ƒê·ªô T·ªïng Th·ªÉ</h3>
              <p class="stat-description">
                ƒê√£ ho√†n th√†nh <strong>{{ getCompletedCount() }}/4</strong> ch·∫ø ƒë·ªô h·ªçc
              </p>
            </div>
          </div>
          
          <div class="progress-bar-container">
            <nz-progress 
              [nzPercent]="overallProgress" 
              [nzStrokeColor]="getProgressColor()"
              [nzStrokeWidth]="12"
              [nzShowInfo]="false">
            </nz-progress>
          </div>
        </div>
        
        <div class="progress-message">
          <div *ngIf="overallProgress === 0" class="message-content start">
            <span class="message-icon">üöÄ</span>
            <div class="message-text">
              <h4>S·∫µn s√†ng chinh ph·ª•c!</h4>
              <p>H√£y b·∫Øt ƒë·∫ßu v·ªõi Flashcard ƒë·ªÉ ghi nh·ªõ t·ª´ v·ª±ng</p>
            </div>
          </div>
          
          <div *ngIf="overallProgress > 0 && overallProgress < 100" class="message-content progress">
            <span class="message-icon">üí™</span>
            <div class="message-text">
              <h4>ƒêang ti·∫øn b·ªô t·ªët!</h4>
              <p>Ti·∫øp t·ª•c n·ªó l·ª±c ƒë·ªÉ chinh ph·ª•c b·ªô th·∫ª n√†y</p>
            </div>
          </div>
          
          <div *ngIf="overallProgress === 100" class="message-content completed">
            <span class="message-icon">üéâ</span>
            <div class="message-text">
              <h4>Ho√†n th√†nh xu·∫•t s·∫Øc!</h4>
              <p>B·∫°n ƒë√£ chinh ph·ª•c to√†n b·ªô 4 ch·∫ø ƒë·ªô h·ªçc</p>
            </div>
          </div>
        </div>
      </div>
    </nz-card>

    <!-- Learning Modes Path -->
    <div class="learning-modes-section">
      <h2 class="section-title">
        <span class="title-icon">üó∫Ô∏è</span>
        L·ªô Tr√¨nh H·ªçc T·∫≠p
      </h2>
      <p class="section-subtitle">
        Ho√†n th√†nh 4 ch·∫ø ƒë·ªô h·ªçc theo th·ª© t·ª± ƒë·ªÉ chinh ph·ª•c b·ªô th·∫ª
      </p>

      <div class="modes-path">
        <div 
          *ngFor="let mode of learningModes; let i = index; trackBy: trackByMode"
          class="mode-card-wrapper"
          [class.locked]="mode.isLocked"
          [class.completed]="mode.isCompleted"
          [class.current]="!mode.isCompleted && !mode.isLocked">
          
          <!-- Connecting Line -->
          <div class="mode-connector" *ngIf="i < learningModes.length - 1"></div>
          
          <!-- Mode Card -->
          <div class="mode-card" 
               [style.border-color]="mode.color"
               (click)="startMode(mode)">
            
            <!-- Lock Overlay -->
            <div class="lock-overlay" *ngIf="mode.isLocked">
              <div class="lock-icon">
                <span nz-icon nzType="lock" nzTheme="outline"></span>
              </div>
              <p class="lock-message">Ho√†n th√†nh ch·∫ø ƒë·ªô tr∆∞·ªõc</p>
            </div>
            
            <!-- Mode Header -->
            <div class="mode-header" [style.background]="mode.gradient">
              <div class="mode-icon-wrapper">
                <span class="mode-icon" nz-icon [nzType]="mode.icon" nzTheme="outline"></span>
              </div>
              <div class="mode-number">{{ mode.order }}</div>
              
              <!-- Status Badge -->
              <div class="status-badge" *ngIf="mode.isCompleted">
                <span nz-icon nzType="check-circle" nzTheme="fill"></span>
                Ho√†n th√†nh
              </div>
              
              <div class="status-badge current" *ngIf="!mode.isCompleted && !mode.isLocked">
                <span nz-icon nzType="play-circle" nzTheme="fill"></span>
                Hi·ªán t·∫°i
              </div>
            </div>
            
            <!-- Mode Content -->
            <div class="mode-content">
              <h3 class="mode-name">{{ mode.nameVi }}</h3>
              <p class="mode-description">{{ mode.description }}</p>
              
              <!-- Score Display -->
              <div class="mode-stats" *ngIf="mode.isCompleted && mode.score !== undefined">
                <div class="stat-badge score">
                  <span nz-icon nzType="trophy" nzTheme="outline"></span>
                  <span>{{ mode.score }} ƒëi·ªÉm</span>
                </div>
                <div class="stat-badge date" *ngIf="mode.completedAt">
                  <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
                  <span>{{ mode.completedAt | date:'dd/MM/yyyy' }}</span>
                </div>
              </div>
              
              <!-- Action Button -->
              <button 
                nz-button 
                [nzType]="mode.isCompleted ? 'default' : 'primary'"
                nzBlock
                class="mode-action-btn"
                [disabled]="mode.isLocked"
                (click)="startMode(mode)">
                <span *ngIf="!mode.isCompleted && !mode.isLocked">
                  <span nz-icon nzType="rocket" nzTheme="outline"></span>
                  B·∫Øt ƒë·∫ßu
                </span>
                <span *ngIf="mode.isCompleted">
                  <span nz-icon nzType="redo" nzTheme="outline"></span>
                  H·ªçc l·∫°i
                </span>
                <span *ngIf="mode.isLocked">
                  <span nz-icon nzType="lock" nzTheme="outline"></span>
                  ƒê√£ kh√≥a
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tips Section -->
    <nz-card class="tips-card" [nzBordered]="false">
      <div class="tips-content">
        <div class="tips-icon">üí°</div>
        <div class="tips-text">
          <h4>M·∫πo H·ªçc Hi·ªáu Qu·∫£</h4>
          <ul class="tips-list">
            <li>üéØ <strong>Flashcard:</strong> Ghi nh·ªõ t·ª´ v·ª±ng qua l·∫∑p l·∫°i c√°ch nh·ªõ</li>
            <li>‚úÖ <strong>Quiz:</strong> Ki·ªÉm tra ƒë·ªô ch√≠nh x√°c v√† t·ªëc ƒë·ªô ph·∫£n x·∫°</li>
            <li>üéß <strong>Listening:</strong> R√®n luy·ªán kh·∫£ nƒÉng nghe v√† ph√°t √¢m</li>
            <li>‚úçÔ∏è <strong>Writing:</strong> Th·ª±c h√†nh vi·∫øt c√¢u ho√†n ch·ªânh v·ªõi AI</li>
          </ul>
        </div>
      </div>
    </nz-card>
  </div>
</div>
